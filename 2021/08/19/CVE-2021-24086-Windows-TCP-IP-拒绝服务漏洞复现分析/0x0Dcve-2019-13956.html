<hr>
<p>title: 0x0Dcve-2019-13956<br>date: 2020-11-12 14:55:00<br>tags:</p>
<ul>
<li>discuz<br>categories:</li>
<li>漏洞复现</li>
</ul>
<hr>
<h4 id="CVE-2019-13956Discuz-ML远程代码执行"><a href="#CVE-2019-13956Discuz-ML远程代码执行" class="headerlink" title="CVE-2019-13956Discuz! ML远程代码执行"></a>CVE-2019-13956Discuz! ML远程代码执行</h4><p>参考：<a href="https://www.cnblogs.com/yuzly/p/11386755.html">https://www.cnblogs.com/yuzly/p/11386755.html</a></p>
<!--more-->

<h5 id="0x1-复现过程"><a href="#0x1-复现过程" class="headerlink" title="0x1 复现过程"></a>0x1 复现过程</h5><p>这个漏洞复现起来还是很容易的，软件也是免费开源的，搭起来就没什么问题</p>
<p>先去下载了v3.3的版本：<a href="https://sourceforge.net/p/discuz-ml/code/ci/v.3.3/tarball?path=">https://sourceforge.net/p/discuz-ml/code/ci/v.3.3/tarball?path=</a></p>
<p>然后开PHPstudy往里一放即可到网页上Install</p>
<p>点击链接抓包改包</p>
<p><img src="/Users/kami/Desktop/hexo/source/_posts/0x0Dcve-2019-13956/image-20201112150139079.png" alt="image-20201112150139079"></p>
<p>可以看到缓存里的内容被更改了</p>
<p><img src="/Users/kami/Desktop/hexo/source/_posts/0x0Dcve-2019-13956/image-20201112150217140.png" alt="image-20201112150217140"></p>
<p>上传shell</p>
<p><img src="/Users/kami/Desktop/hexo/source/_posts/0x0Dcve-2019-13956/image-20201112150159180.png" alt="image-20201112150159180"></p>
<h5 id="0x2-漏洞原理"><a href="#0x2-漏洞原理" class="headerlink" title="0x2 漏洞原理"></a>0x2 漏洞原理</h5><p>在/upload/source/module/portal/portal_index.php文件中</p>
<p><img src="0x0Dcve-2019-13956/image-20201112155957305.png" alt="image-20201112155957305"></p>
<p>使用template函数处理’diy:portal/index’,然后使用include_once包含</p>
<p>include_once：</p>
<p>可以用于在脚本执行期间同一个文件有可能被包含超过一次的情况下，想确保它只被包含一次以避免函数重定义，变量重新赋值等问题。 </p>
<p>跟进template函数：</p>
<p><img src="0x0Dcve-2019-13956/image-20201112160428730.png" alt="image-20201112160428730"></p>
<p>可以看到返回的是一个拼接值,以及相关的两个变量DISCUZ_LANG和DISCUZ_ROOT</p>
<p>找到它们的定义，DISCUZ_ROOT是个固定的</p>
<p><img src="0x0Dcve-2019-13956/image-20201112162712111.png" alt="image-20201112162712111"></p>
<p>DISCUZ_LANG和$lng有关</p>
<p><img src="0x0Dcve-2019-13956/image-20201112162520552.png" alt="image-20201112162520552"></p>
<p>我们可以看到$lng和cookie中的languages有关，那我们就可以控制这个变量然后改包了</p>
<p><img src="0x0Dcve-2019-13956/image-20201112162914790.png" alt="image-20201112162914790"></p>
